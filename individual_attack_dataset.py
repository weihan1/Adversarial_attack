from adversarial_attack_dataset import *
import transformers
from textattack.attack_recipes.bae_garg_2019 import BAEGarg2019


def perform_individual_attack_on_dataset(dataset, label):
    '''
    Perform an individual attack on a dataset.
    Dataset is a string containing the text
    Label is the the binary label encoding whether the dataset is generated by AI or not (1 yes, 0 no)
    '''
    dataset_transformed = [(dataset, label)]
    model = BertForSequenceClassification.from_pretrained('bert-base-uncased')
    model.load_state_dict(torch.load("models/best_model.pt"))
    model.eval()
    tokenizer = transformers.AutoTokenizer.from_pretrained("textattack/bert-base-uncased-imdb")
    model_wrapper = textattack.models.wrappers.HuggingFaceModelWrapper(model, tokenizer)
    attack_args = textattack.AttackArgs(
        num_examples=1,
        log_to_csv = "log2.csv",
        checkpoint_interval=5,
        checkpoint_dir="checkpoints2/",
        disable_stdout=False,
    )
    attack = textattack.attack_recipes.TextFoolerJin2019.build(model_wrapper)
    dataset = Dataset(dataset_transformed)
    
    attacker = textattack.Attacker(attack, dataset, attack_args)
    print(attacker.attack_dataset())
if __name__ == "__main__":
    
    # model = BertForSequenceClassification.from_pretrained('bert-base-uncased')
    # model.load_state_dict(torch.load("models/best_model.pt"))
    # model.eval()
    
# Configure the TextAttack attack recipe
    
    
    dataset_transformed = [("Birds have captivated human imagination for centuries with their breathtaking beauty, melodious songs, and remarkable ability to soar through the skies. These fascinating creatures, belonging to the class Aves, have evolved and adapted to diverse habitats across the globe, exhibiting a myriad of colors, shapes, sizes, and behaviors. From the magnificent peacock displaying its vibrant plumage to the agile hummingbird darting between flowers, birds enrich our world with their presence and contribute to the intricate balance of ecosystems.One of the most remarkable features of birds is their ability to fly. Their wings, uniquely designed for this purpose, allow them to navigate the air with grace and precision. The power of flight grants birds unparalleled freedom, enabling them to travel vast distances in search of food, mates, and suitable nesting sites. From the majestic albatross, which can glide for thousands of miles over the open ocean, to the tiny migratory warblers crossing continents, birds showcase the true essence of aerial mastery.", 1)]

    model = BertForSequenceClassification.from_pretrained('bert-base-uncased')
    model.load_state_dict(torch.load("models/best_model.pt"))
    model.eval()
    print(model)
    tokenizer = transformers.AutoTokenizer.from_pretrained("textattack/bert-base-uncased-imdb")
    model_wrapper = textattack.models.wrappers.HuggingFaceModelWrapper(model, tokenizer)

    attack_args = textattack.AttackArgs(
        num_examples=1,
        log_to_csv = "log2.csv",
        checkpoint_interval=5,
        checkpoint_dir="checkpoints2/",
        disable_stdout=False,
    )
    attack = textattack.attack_recipes.TextFoolerJin2019.build(model_wrapper)
    dataset = Dataset(dataset_transformed)
    
    attacker = textattack.Attacker(attack, dataset, attack_args)
    print(attacker.attack_dataset())